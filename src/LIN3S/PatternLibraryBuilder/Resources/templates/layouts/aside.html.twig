{% macro accordion_menu(children, breadcrumbs) %}
    {% import _self as macros %}

    {% set items = [] %}
    {% for item in children %}

        {% set modifiers = [] %}
        {% for breadcrumb in breadcrumbs %}
            {% if breadcrumb == item.title %}
                {% set modifiers = ['opened'] %}
            {% endif %}
        {% endfor %}

        {% if item.children is not empty %}
            {% set accordion_item_title %}
                {{ item.title|replace({'-': ' '}) }}
                {% include '@lin3s_pattern_library_builder/svg/icon_plus.svg.twig' %}
            {% endset %}
            {% set accordion_item_content = macros.accordion_menu(item.children, breadcrumbs) %}
        {% else %}
            {% set accordion_item_title %}
                {% embed '@lin3s_pattern_library_builder/components/link.html.twig' with {
                    url: item.slug,
                    target: '_self'
                } %}
                    {%- block link_content -%}
                        {% include '@lin3s_pattern_library_builder/components/status.html.twig' with {
                            level: item.status,
                            tag: 'span'
                        } %}
                        {{ item.title|replace({'-': ' '}) }}
                    {%- endblock -%}
                {% endembed %}
            {% endset %}

            {% set modifiers = modifiers|merge(['leaf']) %}
        {% endif %}

        {% set items = items|merge([{
            header: accordion_item_title,
            content: accordion_item_content,
            modifiers: modifiers
        }]) %}
    {% endfor %}

    {% include '@lin3s_pattern_library_builder/components/accordion.html.twig' with {
        items: items,
        modifier: modifier
    } %}
{% endmacro %}

{% import _self as aside %}

<aside class="aside">
    <div class="aside__header">
        {% block logo %}{% endblock %}
        <p>{{ title }}</p>
        <p>{{ description }}</p>
    </div>
    <div class="aside__content">
        {{ aside.accordion_menu(menu, breadcrumbs) }}
    </div>
</aside>
