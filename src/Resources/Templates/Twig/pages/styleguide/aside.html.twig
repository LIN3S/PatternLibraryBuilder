{% macro status(status_level) %}
    {% set status = 'done' %}
    {% if status_level == 0 %}
        {% set status = 'todo' %}
    {% elseif status_level == 1 %}
        {% set status = 'doing' %}
    {% elseif status_level == 2 %}
        {% set status = 'pending-review' %}
    {% endif %}

    {% set status_text = status|replace({'-': ' '}) %}

    <span class="status status--{{- status -}}">{{ status_text }}</span>
{% endmacro %}

{% macro accordion_menu(children, breadcrumbs) %}
    {% import '@Euskaltel/components/macro/accordions.html.twig' as accordions %}
    {% import '@Euskaltel/atoms/macro/links.html.twig' as links %}
    {% import _self as macros %}

    {% set items = [] %}
    {% for item in children %}

        {% set modifiers = [] %}
        {% for breadcrumb in breadcrumbs %}
            {% if breadcrumb == item.title %}
                {% set modifiers = ['opened'] %}
            {% endif %}
        {% endfor %}

        {% if item.children is not empty %}
            {% set accordion_item_title %}
                {{ item.title|replace({'-': ' '}) }}
                {% include '@Euskaltel/svg/plus.svg.twig' %}
            {% endset %}
            {% set accordion_item_content = macros.accordion_menu(item.children, breadcrumbs) %}
        {% else %}
            {% set accordion_item_title %}
                <div class="styleguide__menu-link">
                    {% embed '@Euskaltel/atoms/link.html.twig' with {
                        url: item.slug,
                        target: '_self'
                    } %}
                        {%- block link_content -%}
                            {{ macros.status(item.status) }}
                            {{ item.title|replace({'-': ' '}) }}
                        {%- endblock -%}
                    {% endembed %}
                </div>
            {% endset %}

            {% set modifiers = modifiers|merge(['leaf']) %}
        {% endif %}

        {% set items = items|merge([{
            header: accordion_item_title,
            content: accordion_item_content,
            modifiers: modifiers
        }]) %}
    {% endfor %}

    {{ accordions.accordion(items) }}
{% endmacro %}

{% import _self as aside %}

<div class="styleguide__header">
    {% include '@Euskaltel/svg/euskaltel.svg.twig' %}
    <p>Design System</p>
    <p>v0.0.1</p>
</div>
<div class="styleguide__menu">
    {{ aside.accordion_menu(menu, breadcrumbs) }}
</div>
